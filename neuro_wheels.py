# -*- coding: utf-8 -*-
"""neuro_wheels.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1PdC8uc28kz6-bvF2JUWaNg2OL6qqi2ob
"""



import streamlit as st
import numpy as np
import time
import pandas as pd
from transformers import GPT2LMHeadModel, GPT2Tokenizer

# Load the pre-trained GPT-2 model and tokenizer
model = GPT2LMHeadModel.from_pretrained("gpt2")
tokenizer = GPT2Tokenizer.from_pretrained("gpt2")

# Function to generate a doctor-like, friendly response
def get_response(user_input):
    # Define the instructions for the model to ensure it responds like a friendly doctor
    doctor_prompt = (
        "You are a compassionate and professional doctor helping individuals with mobility impairments. "
        "Your responses should always be calming, supportive, and kind, with a focus on patient care. "
        "When answering, imagine you are speaking to someone who is going through a challenging time and "
        "needs encouragement and practical advice. "
        "Here is a question from a patient: "
    )

    # Combine the doctor-like instructions with the user's input
    full_input = doctor_prompt + user_input

    # Encode the input text into tokens
    inputs = tokenizer.encode(full_input, return_tensors="pt")

    # Generate a response from the model
    outputs = model.generate(inputs, max_length=150, num_return_sequences=1, no_repeat_ngram_size=2)

    # Decode the output tokens to text
    response = tokenizer.decode(outputs[0], skip_special_tokens=True)

    return response

# Streamlit page configuration
st.set_page_config(page_title="NeuroWheels - Chat with NeuroGuide", layout="wide")

# App title
st.title("ðŸ§  NeuroWheels")

# Sidebar menu
menu = st.sidebar.selectbox("Navigate", [
    "Welcome & Instructions",
    "Chat with NeuroGuide",
    "View Brain Signals",
    "Upgrade & Add-ons"
])

# Session state for chat
if "chat_history" not in st.session_state:
    st.session_state.chat_history = []

# -------------------------------
# Chatbot Section (NeuroGuide)
# -------------------------------
if menu == "Chat with NeuroGuide":
    st.header("ðŸ¤– NeuroGuide - Your Brainy Assistant")

    # User input field
    user_input = st.text_input("Ask NeuroGuide anything...")

    if user_input:
        # Add user input to the chat history
        user_message = f"User: {user_input}"
        st.session_state.chat_history.append(user_message)

        # Get response from the model
        bot_response = get_response(user_input)
        st.session_state.chat_history.append(f"NeuroGuide: {bot_response}")

        # Display the chat history
        for message in st.session_state.chat_history:
            st.write(message)

# -------------------------------
# Welcome & Instructions Section
# -------------------------------
elif menu == "Welcome & Instructions":
    st.header("ðŸ‘‹ Welcome to NeuroWheels!")
    st.subheader("Your Personal NeuroCompanion")

    st.markdown("Hi there! I'm **NeuroGuide**, here to help you monitor, understand, and interact with your brain signals through our AI-powered assistant and signal viewer.")
    
    if st.button("ðŸ§¾ Show My Info"):
        with st.expander("Your Profile"):
            st.write("**Name:** Mariam Kandari")
            st.write("**Usage Type:** Caregiver / Researcher")
            st.write("**Last Session:** April 17, 2025")
            st.write("**Connected Device:** BITalino EEG Kit")
            st.success("You're all set and connected!")

    st.divider()
    st.subheader("ðŸ›  How to Use This App")
    st.markdown("""
    - ðŸ‘‰ **Chat with NeuroGuide**
    - ðŸ“Š **Health Check-Ups**
    - ðŸŽ¯ **Unlock Features**
    """)

# -------------------------------
# View Brain Signals Section
# -------------------------------
elif menu == "View Brain Signals":
    st.header("ðŸ“Š Real-Time BioSignal Dashboard")
    placeholder = st.empty()

    for _ in range(100):
        t = np.linspace(0, 2, 256)
        brain_wave = np.sin(2 * np.pi * (10 + np.random.rand()) * t) + 0.3 * np.random.randn(len(t))

        heart_rate = np.random.randint(65, 100)
        breathing_rate = np.random.randint(12, 20)
        stress_level = np.random.uniform(0, 1)
        overall_health = "Good" if stress_level < 0.6 else "Moderate" if stress_level < 0.8 else "Stressed"

        with placeholder.container():
            st.subheader("ðŸ§  Brainwave Signal")
            brain_wave_df = pd.DataFrame({"Time (s)": t, "EEG": brain_wave})
            st.line_chart(brain_wave_df.set_index("Time (s)"))

            col1, col2, col3, col4 = st.columns(4)
            col1.metric("â¤ï¸ Heart Rate", f"{heart_rate} bpm")
            col2.metric("ðŸ’¨ Breathing", f"{breathing_rate} rpm")
            col3.metric("ðŸ˜¬ Stress", f"{stress_level:.2f}")
            col4.metric("ðŸ§‘â€âš•ï¸ Health", overall_health)

            st.info("â³ Streaming live simulated data...")

        time.sleep(0.1)

# -------------------------------
# Upgrade & Add-on Features Section
# -------------------------------
elif menu == "Upgrade & Add-ons":
    st.header("ðŸ’³ Upgrade to Premium & Add Features")

    st.markdown("**Enjoy enhanced functionality by upgrading or adding hardware to your NeuroWheels experience.**")

    st.subheader("ðŸ§  Premium Version")
    upgrade = st.checkbox("Upgrade to Premium (5 KD)", value=False)

    st.subheader("ðŸ›’ Additional Features")
    buy_arm = st.checkbox("Add Robotic Arm (45 KD)", value=False)
    buy_tablet = st.checkbox("Add Built-in Tablet (30 KD)", value=False)

    # Calculate total
    total = 0
    if upgrade:
        total += 5
    if buy_arm:
        total += 45
    if buy_tablet:
        total += 30

    st.divider()

    st.subheader("ðŸ§¾ Order Summary")
    if total == 0:
        st.info("No upgrades or add-ons selected.")
    else:
        st.success(f"Total: {total} KD")
        if st.button("Proceed to Payment"):
            st.balloons()
            st.success("Thank you! Your upgrades will be activated shortly.")
